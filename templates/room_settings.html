{% extends "base.html" %}
{% block content %}
<div class="chat-area" style="display: flex; flex-direction: column; overflow-y: auto; grid-column: 2 / 4 !important;">
    <div style="padding: 40px;">
        <div style="max-width: 600px; margin: 0 auto;">
            <h1 style="font-size: 2rem; font-weight: 700; color: var(--text-main); margin-bottom: 32px;">Server Settings</h1>
            
            <div class="card">
                <form method="POST" enctype="multipart/form-data">
                    <div class="input-group">
                        <label class="input-label">Server Name</label>
                        <input type="text" name="name" value="{{ room.name }}" class="custom-input" required>
                    </div>
                    
                    <div style="margin: 24px 0; text-align: center;">
                        {% if room.avatar_url %}
                        <img src="{{ room.avatar_url }}" id="avatarPreview" style="width: 120px; height: 120px; border-radius: 50%; object-fit: cover; margin-bottom: 14px; cursor: pointer; border: 3px solid var(--border);" onclick="document.getElementById('avatar_file').click();">
                        {% else %}
                        <div id="avatarPreview" style="width: 120px; height: 120px; border-radius: 50%; background: var(--bg-panel); display: flex; align-items: center; justify-content: center; margin: 0 auto 14px; cursor: pointer; border: 3px solid var(--border);">
                            <span class="material-icons-round" style="font-size: 56px; color: var(--text-muted);">public</span>
                        </div>
                        {% endif %}
                        <br>
                        <input type="file" name="avatar_file" id="avatar_file" accept="image/*" style="display: none;" onchange="previewAvatar(this);">
                        <div style="display: flex; flex-direction: column; gap: 10px; margin-top: 14px;">
                            <button type="button" class="btn btn-login" onclick="document.getElementById('avatar_file').click();">Upload Server Icon</button>
                            {% if room.avatar_url %}
                            <button type="button" class="btn" style="background: var(--danger); color: var(--text-main);" onclick="deleteRoomAvatar({{ room.id }});">Delete Icon</button>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 12px; margin-top: 24px;">
                        <button type="submit" class="btn btn-login" style="flex: 1;">Save Changes</button>
                        <a href="{{ url_for('main.view_room', room_id=room.id) }}" class="btn btn-secondary" style="flex: 1; text-decoration: none; text-align: center; display: flex; align-items: center; justify-content: center;">Cancel</a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
function previewAvatar(input) {
    if (input.files && input.files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) {
            document.getElementById('avatarPreview').src = e.target.result;
        };
        reader.readAsDataURL(input.files[0]);
    }
}

function deleteRoomAvatar(roomId) {
    if (!confirm('Delete server icon?')) return;
    
    fetch(`/room/${roomId}/avatar/delete`, { method: 'POST' })
    .then(r => r.json())
    .then(data => {
        if (data.success) {
            location.reload();
        } else {
            alert('Error: ' + (data.error || 'Unknown error'));
        }
    });
}
</script>
{% endblock %}

